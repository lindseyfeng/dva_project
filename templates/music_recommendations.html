{% extends "base.html" %} {% block title %}Music Recommendations{% endblock %}
{% block extra_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/music_recommendations.css') }}"
/>
{% endblock %} {% block content %}
<h1 class="mt-5">Music Recommendations</h1>

<form id="music-recommendations-form" class="mt-4">
  <div class="form-group">
    <label for="preferences">Enter Your Preferences:</label>
    <input
      type="text"
      id="preferences"
      name="preferences"
      class="form-control"
      required
    />
  </div>
  <button type="submit" class="btn btn-primary">Get Recommendations</button>
</form>

<div id="recommendations-result" class="mt-4"></div>
<!-- we might have too many things per cluster right now -->
<!-- add a d3 thing here where we can select ones we like from the recommendations and then it will update the recommendations -->
<script>
  document
    .getElementById("music-recommendations-form")
    .addEventListener("submit", async function (event) {
      event.preventDefault(); // Prevent default form submission

      // Get the value from the input field
      const preferences = document.getElementById("preferences").value;

      // Send the data to the server
      try {
        const response = await fetch("/get-recommendations", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ favorite_artist: preferences }),
        });

        // Parse the JSON response
        const data = await response.json();

        // Update the result container with the server's response
        const resultDiv = document.getElementById("recommendations-result");

        if (response.ok) {
          // Successful response
          resultDiv.innerText = data.recommendations;
        } else {
          // Handle errors returned by the server
          resultDiv.innerText = data.error || "An unexpected error occurred.";
        }
      } catch (error) {
        // Handle network or unexpected errors
        const resultDiv = document.getElementById("recommendations-result");
        resultDiv.innerText = "An error occurred while connecting to the server.";
        console.error("Error:", error);
      }
    });
</script>

{% endblock %}
